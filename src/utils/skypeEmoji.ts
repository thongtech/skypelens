/**
 * Maps Skype emoji shortcodes to their Unicode emoji equivalents.
 * Handles both XML tags (<ss type="smile">) and shorthand notation ((smile)).
 */
const skypeEmojiMap: Record<string, string> = {
  smile: "ğŸ˜Š",
  sadsmile: "ğŸ™",
  bigsmile: "ğŸ˜ƒ",
  cool: "ğŸ˜",
  wink: "ğŸ˜‰",
  crying: "ğŸ˜¢",
  sweat: "ğŸ˜“",
  speechless: "ğŸ˜¶",
  kiss: "ğŸ˜˜",
  kissingfacewithsmilingeyes: "ğŸ˜™",
  "1f619_kissingfacewithsmilingeyes": "ğŸ˜™",
  tongueout: "ğŸ˜›",
  blush: "ğŸ˜Š",
  wonder: "ğŸ˜•",
  sleepy: "ğŸ˜´",
  dull: "ğŸ˜’",
  inlove: "ğŸ˜",
  evilgrin: "ğŸ˜ˆ",
  talking: "ğŸ—£ï¸",
  yawn: "ğŸ¥±",
  puke: "ğŸ¤®",
  doh: "ğŸ¤¦",
  angry: "ğŸ˜ ",
  wasntme: "ğŸ¤·",
  party: "ğŸ¥³",
  worried: "ğŸ˜Ÿ",
  mmm: "ğŸ˜‹",
  nerd: "ğŸ¤“",
  lipssealed: "ğŸ¤",
  devil: "ğŸ˜ˆ",
  angel: "ğŸ˜‡",
  envy: "ğŸ˜’",
  makeup: "ğŸ’„",
  think: "ğŸ¤”",
  rofl: "ğŸ¤£",
  happy: "ğŸ˜Š",
  smirk: "ğŸ˜",
  emo: "ğŸ˜”",
  surprise: "ğŸ˜²",
  swear: "ğŸ¤¬",
  giggle: "ğŸ˜†",
  wondering: "ğŸ¤”",
  sleepless: "ğŸ˜«",
  snooze: "ğŸ˜´",
  sick: "ğŸ¤’",
  sweating: "ğŸ˜°",
  smiling: "ğŸ˜Š",
  grinning: "ğŸ˜",
  fearful: "ğŸ˜¨",
  relieved: "ğŸ˜Œ",
  triumph: "ğŸ˜¤",
  unamused: "ğŸ˜‘",
  facepalm: "ğŸ¤¦",
  shrug: "ğŸ¤·",
  fubar: "ğŸ˜µ",
  inpain: "ğŸ˜£",
  bandit: "ğŸ˜",
  confident: "ğŸ˜",
  confidential: "ğŸ¤",
  malthe: "ğŸ˜„",
  nerdy: "ğŸ¤“",
  oliver: "ğŸ˜Š",
  selfie: "ğŸ¤³",
  toivo: "ğŸ˜„",
  lol: "ğŸ˜‚",
  sob: "ğŸ˜­",
  loudlycrying: "ğŸ˜­",
  joy: "ğŸ˜‚",
  grin: "ğŸ˜",
  stuck: "ğŸ˜›",
  sunglasses: "ğŸ˜",
  neutral: "ğŸ˜",
  nomouth: "ğŸ˜¶",
  innocent: "ğŸ˜‡",
  smileeyes: "ğŸ˜Š",
  smilingeyes: "ğŸ˜Š",
  relaxed: "â˜ºï¸",
  yum: "ğŸ˜‹",
  drunk: "ğŸ¥´",
  facewithmonocle: "ğŸ§",
  mindblown: "ğŸ¤¯",
  kissingclosedeyes: "ğŸ˜š",
  smilingfacewithtear: "ğŸ¥²",
  pleadingface: "ğŸ¥º",
  disguisedface: "ğŸ¥¸",
  partyingface: "ğŸ¥³",
  woozyface: "ğŸ¥´",
  dottedlineface: "ğŸ«¥",
  facewithdiagonalmouth: "ğŸ«¤",
  shakingface: "ğŸ«¨",
  smilingfacewithhalo: "ğŸ˜‡",
  smilingfacewithhorns: "ğŸ˜ˆ",
  skull: "ğŸ’€",
  skullandcrossbones: "â˜ ï¸",

  hi: "ğŸ‘‹",
  wave: "ğŸ‘‹",
  bye: "ğŸ‘‹",
  clap: "ğŸ‘",
  bow: "ğŸ™‡",
  pray: "ğŸ™",
  rock: "ğŸ¤˜",
  muscle: "ğŸ’ª",
  handshake: "ğŸ¤",
  nod: "ğŸ‘",
  shake: "ğŸ‘",
  yes: "âœ”ï¸",
  no: "âŒ",
  talktothehand: "ğŸ–ï¸",
  finger: "â˜ï¸",
  pointupindex: "â˜ï¸",
  fingers: "ğŸ¤",
  highfive: "ğŸ™Œ",
  ok: "ğŸ‘Œ",
  punch: "ğŸ‘Š",
  victory: "âœŒï¸",
  thumbsup: "ğŸ‘",
  thumbsdown: "ğŸ‘",
  thumbs: "ğŸ‘",
  fist: "ğŸ‘Š",
  v: "âœŒï¸",
  raised: "âœ‹",
  raisedhand: "âœ‹",
  raisedback: "ğŸ¤š",
  vulcan: "ğŸ––",
  middlefinger: "ğŸ–•",
  headbang: "ğŸ¤˜",
  flex: "ğŸ’ª",

  womanartist: "ğŸ‘©â€ğŸ¨",

  heart: "â¤ï¸",
  brokenheart: "ğŸ’”",
  hearthands: "ğŸ«¶",
  love: "ğŸ˜",
  lips: "ğŸ‘„",
  hug: "ğŸ¤—",
  kissmark: "ğŸ’‹",
  hearteyes: "ğŸ˜",
  heartkiss: "ğŸ˜˜",

  dog: "ğŸ•",
  cat: "ğŸˆ",
  penguin: "ğŸ§",
  penguinkiss: "ğŸ§ğŸ˜˜",
  panda: "ğŸ¼",
  monkey: "ğŸµ",
  hedgehog: "ğŸ¦”",
  llama: "ğŸ¦™",
  sheep: "ğŸ‘",
  pig: "ğŸ·",
  flower: "ğŸŒ¸",
  sun: "â˜€ï¸",
  moon: "ğŸŒ™",
  star: "â­",
  rain: "ğŸŒ§ï¸",
  rainbow: "ğŸŒˆ",
  cloud: "â˜ï¸",
  lightning: "âš¡",
  snowflake: "â„ï¸",
  fire: "ğŸ”¥",
  nazar: "ğŸ§¿",
  sparkles: "âœ¨",

  coffee: "â˜•",
  pizza: "ğŸ•",
  cake: "ğŸ‚",
  beer: "ğŸº",
  drink: "ğŸ¹",
  wine: "ğŸ·",

  gift: "ğŸ",
  camera: "ğŸ“·",
  phone: "ğŸ“±",
  call: "ğŸ“",
  plane: "âœˆï¸",
  car: "ğŸš—",
  bike: "ğŸš´",
  computer: "ğŸ’»",
  tv: "ğŸ“º",
  movie: "ğŸ¬",
  music: "ğŸµ",
  football: "âš½",
  basketball: "ğŸ€",
  soccer: "âš½",
  tennis: "ğŸ¾",
  trophy: "ğŸ†",
  winner: "ğŸ†",
  celebrate: "ğŸ‰",
  partypopper: "ğŸ‰",
  congrats: "ğŸŠ",
  birthday: "ğŸ‚",
  fireworks: "ğŸ†",
  balloon: "ğŸˆ",
  mail: "âœ‰ï¸",
  time: "â°",
  clock: "â°",
  umbrella: "â˜‚ï¸",
  island: "ğŸï¸",
  flag: "ğŸš©",
  poolparty: "ğŸŠ",
  skipping: "ğŸ¦˜",
  skip: "â­ï¸",
  bricklayers: "ğŸ§±",
  neil: "ğŸ‘¨",

  bomb: "ğŸ’£",
  zzz: "ğŸ’¤",
  boom: "ğŸ’¥",
  sweatdrops: "ğŸ’¦",
  dash: "ğŸ’¨",
  poop: "ğŸ’©",
  tongue: "ğŸ‘…",
  ear: "ğŸ‘‚",
  nose: "ğŸ‘ƒ",
  eye: "ğŸ‘ï¸",
  eyes: "ğŸ‘€",
  "1f440_eyes": "ğŸ‘€",
  bust: "ğŸ‘¤",
  busts: "ğŸ‘¥",
  speech: "ğŸ’¬",
  footprints: "ğŸ‘£",
  cash: "ğŸ’°",
  idea: "ğŸ’¡",
  dont: "ğŸš«",
  hear: "ğŸ‘‚",
  laugh: "ğŸ˜‚",
  mooning: "ğŸ‘",
  tmi: "ğŸ™ˆ",
  waiting: "â³",
  holdon: "âœ‹",
  mytime: "â°",
  myspace: "ğŸŒ",
  lalala: "ğŸµ",
  talk: "ğŸ’¬",
  thinking: "ğŸ¤”",
  listening: "ğŸ‘‚",
  smoking: "ğŸš¬",
  smoke: "ğŸš¬",
  skype: "â˜ï¸",
  mediumwhitesquare: "â—»ï¸",

  ":)": "ğŸ˜Š",
  ":(": "ğŸ™",
  ":d": "ğŸ˜ƒ",
  ":p": "ğŸ˜›",
  ";)": "ğŸ˜‰",
  ":o": "ğŸ˜®",
  ":'(": "ğŸ˜¢",
  ":|": "ğŸ˜",
  ":*": "ğŸ˜˜",
  ":x": "ğŸ˜™",
  ">:)": "ğŸ˜ˆ",
  "<3": "â¤ï¸",
  "</3": "ğŸ’”",
  ":3": "ğŸ˜™",
  ":@": "ğŸ˜ ",
  "^_^": "ğŸ˜Š",
  "-_-": "ğŸ˜‘",
  o_o: "ğŸ˜³",
  "<o>": "ğŸ‘¼",

  d: "ğŸ˜ƒ",
  p: "ğŸ˜›",
  o: "ğŸ˜®",
  s: "ğŸ˜•",
  x: "ğŸ¤",
  "8": "ğŸ˜",
  "|": "ğŸ˜",
  "*": "ğŸ˜˜",
  "@": "ğŸ˜ ",
  "^": "ğŸ˜Š",
};

const emojiPatterns: Array<[RegExp, string]> = Object.keys(skypeEmojiMap)
  .sort((a, b) => b.length - a.length)
  .map((key) => [
    new RegExp(`\\(${key.replace(/[.*+?^${}()|[\]\\]/g, "\\$&")}\\)`, "gi"),
    skypeEmojiMap[key],
  ]);

const ssTagPattern =
  /<ss[^>]*type="([^"]+)"[^>]*>[\s\S]*?<\/ss>/gi;

export function parseSkypeEmoji(text: string): string {
  if (!text) return text;

  let parsed = text.replace(ssTagPattern, (_, rawType) => {
    const type = (rawType ?? "").toLowerCase();
    return skypeEmojiMap[type] || "";
  });

  if (parsed.indexOf("(") === -1) {
    return parsed;
  }

  for (const [pattern, emoji] of emojiPatterns) {
    parsed = parsed.replace(pattern, emoji);
  }
  return parsed;
}
